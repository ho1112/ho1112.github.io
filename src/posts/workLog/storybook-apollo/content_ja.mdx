---
title: 'Storybookã‚’å¾©æ´»ã•ã›ã‚‹(+ with Apollo Client)'
desc: storybook & apollo-client
date: 2025-04-20
thumbnail: /posts/workLog/storybook-apollo/sbicon.avif
---

<h1>storybookã‚’å¾©æ´»ã•ã›ã‚‹</h1>

ì–¼ë§ˆ ì „ íšŒì‚¬ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë˜ Storybookì´ ì–´ëŠ ìˆœê°„ë¶€í„° ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ” ìƒíƒœê°€ ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.
ì´ ê¸°íšŒì— ìµœì‹  ë²„ì „ìœ¼ë¡œ ì™„ì „íˆ ìƒˆë¡­ê²Œ ì„¤ì¹˜í•˜ê³  Docker í™˜ê²½ê³¼ í•¨ê»˜ Apollo Client(GraphQL)ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ì‹œ ë¶€í™œì‹œí‚¨ ê³¼ì •ì„ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

---
## Storybookì´ë€?
Storybookì€ UI ì»´í¬ë„ŒíŠ¸ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œí•˜ê³  í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ë„êµ¬ì…ë‹ˆë‹¤.
ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìì™€ ë””ìì´ë„ˆì˜ í˜‘ì—…ê³¼ íš¨ìœ¨ì„±ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.

ì»´í¬ë„ŒíŠ¸ í™•ì¸ì„ ìœ„í•´ ë¸Œë¼ìš°ì €ë¥¼ ê¸°ë™í•˜ê³  ê·¸ í˜ì´ì§€ê¹Œì§€ ë“¤ì–´ê°€ì§€ ì•Šì•„ë„ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤ëŠ” ê²Œ ê°€ì¥ í° ì¥ì ì…ë‹ˆë‹¤.
ê·¸ë¦¬ê³  í˜„ì¬ ì´ ì„œë¹„ìŠ¤ì— ì‚¬ìš©ë˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì„ í•œ ëˆˆì— ì‚´í´ë³¼ ìˆ˜ ìˆê³  ë…ë¦½ì ì¸ ìƒíƒœì—ì„œì˜ ë™ì‘ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê°œì¸ì ìœ¼ë¡œëŠ” ì¼ë°˜ì ì¸ ìƒíƒœì—ì„œ í™•ì¸í•˜ê¸° ì–´ë ¤ìš´ ëª¨ë‹¬, ì•„ì´ì½˜, ìƒíƒœ ë³€í™”ë¡œ ì¸í•œ ë””ìì¸ ì²´í¬ ì‹œì— ìœ ìš©í•˜ê²Œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
ìì„¸í•œ ë‚´ìš©ì€ ê³µì‹ì‚¬ì´íŠ¸ë¥¼ ì°¸ì¡° ğŸ‘‰ [storybook](https://storybook.js.org/)

## Apollo Clientë€?
Apollo ClientëŠ” GraphQL ì¿¼ë¦¬ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê³  í”„ë¡ íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì—°ë™í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” JavaScript ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
íš¨ìœ¨ì ì´ê³  ìœ ì—°í•œ ë°ì´í„° ë¡œë”©ê³¼ ìºì‹±ì„ ì œê³µí•©ë‹ˆë‹¤.
ìì„¸í•œ ë‚´ìš©ì€ ê³µì‹ì‚¬ì´íŠ¸ë¥¼ ì°¸ì¡° ğŸ‘‰ [apollographql](https://www.apollographql.com/docs/react)

## êµ¬ë²„ì „ Storybook ì‚­ì œ ë° ì‹ ê·œ ì„¤ì¹˜
ê¸°ì¡´ì˜ êµ¬ë²„ì „ Storybookì´ ìµœì‹  í™˜ê²½ê³¼ì˜ í˜¸í™˜ì„± ë¬¸ì œë¡œ ì¸í•´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì•„ì˜ˆ ì™„ì „íˆ ì‚­ì œí•˜ê³  ìµœì‹  ë²„ì „ì˜ Storybookì„ ìƒˆë¡­ê²Œ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤.
ìƒˆë¡­ê²Œ ì„¤ì¹˜í•œ Storybookê³¼ ì• ë“œì˜¨ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
```json
"@storybook/addon-essentials": "7.6.20",
"@storybook/addon-interactions": "7.6.20",
"@storybook/addon-links": "7.6.20",
"@storybook/addon-onboarding": "1.0.11",
"@storybook/blocks": "7.6.20",
"@storybook/nextjs": "7.6.20",
"@storybook/react": "7.6.20",
"@storybook/test": "7.6.20",
"storybook": "7.6.20",
"storybook-addon-apollo-client": "5.0.0",
```

## Storybook ì„œë²„ ê¸°ë™ ë° ë™ì‘ í™•ì¸
ì„¤ì¹˜ê°€ ëë‚˜ê³  Storybookì„ ê¸°ë™í•˜ì—¬ ì œëŒ€ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
```sh
npm run storybook
```
ì´ˆê¸° í¬íŠ¸ë²ˆí˜¸ëŠ” 6006ì´ê¸°ì— `http://localhost:6006`ë¡œ ì ‘ì†í•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

## Docker í™˜ê²½ì—ì„œì˜ Storybook í¬íŠ¸ ê°œë°©
í„°ë¯¸ë„ ìƒì—ì„œ ìŠ¤í† ë¦¬ë¶ ê¸°ë™ì€ ë¬¸ì œê°€ ì—†ì—ˆì§€ë§Œ ì´ê²ƒë§Œìœ¼ë¡œëŠ” í˜ì´ì§€ê°€ ì—´ë¦¬ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
ì›ì¸ì€ Dockerí™˜ê²½ì—ì„œ ê¸°ë™í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ìƒˆë¡œìš´ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  Dockerì—ì„œ í•´ë‹¹ í¬íŠ¸ë¥¼ ê°œë°©í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
ë‹¤ìŒê³¼ ê°™ì´ í¬íŠ¸ë¥¼ ë§¤í•‘í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.
```yaml
# docker-compose.yml
mintora:
    container_name: test-web
    build:
      context: .
      dockerfile: docker/web/local.Dockerfile
    ports:
      - "6006:6006" // storybook í¬íŠ¸ ê°œë°©
    volumes:
      - ./web:/usr/src/app:cached
      - node_modules:/usr/src/app/node_modules
    command: npm run dev
```

í¬íŠ¸ë¥¼ ê°œë°©í•œ ë’¤ ë‹¤ì‹œ ê¸°ë™ì‹œì¼œì£¼ë‹ˆ ìŠ¤í† ë¦¬ë¶ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
![ì´ˆê¸° í™˜ê²½](/posts/workLog/storybook-apollo/storybook_init.png)

## Storybook ì„¤ì •
ìƒˆë¡­ê²Œ ì„¤ì¹˜í•œ ìŠ¤í† ë¦¬ë¶ì„ í˜„ì¬ í™˜ê²½ì— ë§ì¶”ê¸° ìœ„í•´ configì™€ preview íŒŒì¼ì„ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

main.tsì—ëŠ” storiesíŒŒì¼ì„ ì‘ì„±í•  ê²½ë¡œì™€ ì‚¬ìš©í•  ì• ë“œì˜¨ë“¤ì„ ì„¤ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.
```ts
// storybook/main.ts
import type { StorybookConfig } from '@storybook/nextjs'

const path = require('path')

const config: StorybookConfig = {
  stories: [
    '../**/**/*.stories.@(js|jsx|mjs|ts|tsx)',
  ],
  addons: [
    '@storybook/addon-links',
    '@storybook/addon-essentials',
    '@storybook/addon-onboarding',
    '@storybook/addon-interactions',
    'storybook-addon-apollo-client',
  ],
  framework: {
    name: '@storybook/nextjs',
    options: {},
  },
  staticDirs: ['../public'],
  webpackFinal: async (config) => {
    config.resolve = config.resolve || {}
    config.module = config.module || {}
    config.module.rules = config.module.rules || []

    config.resolve.alias = {
      ...config.resolve.alias,
      '@': path.resolve(__dirname, '../'),
      '@styles': path.resolve(__dirname, '../styles'),
      '@components': path.resolve(__dirname, '../components'),
    }
    config.devtool = false
    return config
  },
}
export default config
```

preview.tsì—ëŠ” apollo clientì‚¬ìš©ì„ ìœ„í•´ MockedProviderë¥¼ ì„¤ì •í•´ ë‘ì—ˆìŠµë‹ˆë‹¤.
```ts
// storybook/preview.ts
import type { Preview } from '@storybook/react'
import '../styles/globals.scss'
import { MockedProvider } from '@apollo/client/testing'

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    apolloClient: {
      // apollo/clientã¨Storybookã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦Addonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§æ³¨æ„
      // https://storybook.js.org/addons/storybook-addon-apollo-client
      MockedProvider,
    },
  },
}

export default preview
```

## stories ì‘ì„±
ì´ì œ ì´ˆê¸° í™˜ê²½ ì„¤ì •ì´ ëª¨ë‘ ëë‚¬ê¸° ë•Œë¬¸ì— stories íŒŒì¼ë“¤ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

storiesíŒŒì¼ì€ ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤.
```ts
// Button/index.stories.tsx
import {
  PrimaryButton,
  ...
} from './index'
import type { Meta, StoryObj } from '@storybook/react'

const meta: Meta = {
  title: 'Components/Buttons',
  parameters: {
    // ì»´í¬ë„ŒíŠ¸ ë°°ì¹˜: centered, fullscreen, padded
    layout: 'centered',
  },
  // Doc ìë™ ì‘ì„±
  tags: ['autodocs'],
  // ì»´í¬ë„ŒíŠ¸ì˜ ë§¤ê°œë³€ìˆ˜ ì§€ì •
  argTypes: {
    icon: {
      control: 'text',
      description: 'iconå',
    },
    disabled: {
      control: 'boolean',
      description: 'Disabled',
    },
  },
}
export default meta

export const Primary: StoryObj<typeof PrimaryButton> = {
  render: (args) => <PrimaryButton {...args} />,
  args: {
    type: 'button',
    icon: 'offer',
    disabled: false,
    isLoading: false,
    onClick: () => {
      alert('click')
    },
  },
}
...
```

ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ ì´ì™¸ì— ë‹¨ìˆœ í™•ì¸ì„ ìœ„í•´ì„œë„ storiesë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì•„ë˜ëŠ” ì´ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì•„ì´ì½˜ ëª©ë¡ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì‘ì„±í•œ ìŠ¤í† ë¦¬ì…ë‹ˆë‹¤.
```ts
// Icon/index.stories.tsx
import { Icon } from './index'
import type { Meta, StoryObj } from '@storybook/react'

const meta = {
  title: 'Components/Icon',
  component: Icon,
  parameters: {
    // centered, fullscreen, padded
    layout: 'padded',
  },
  argTypes: {
    icon: {
      control: 'text',
      description: 'iconå',
    },
    size: {
      control: 'number',
      description: 'ã‚µã‚¤ã‚º(rem)',
    },
  },
  tags: ['autodocs'],
} satisfies Meta<typeof Icon>

export default meta
type Story = StoryObj<typeof meta>

const glyphNames = [
  'camera',
  'operating',
  'company',
  'document',
  'instagram',
  'logout',
  'question',
  ... ìƒëµ
  'operator',
  'searchCheck',
]

export const Default: Story = {
  args: {
    icon: '',
    size: 24,
  },
  render: (args) => (
    <div style={{ display: 'flex', flexDirection: 'column' }}>
      {glyphNames.map((iconName) => (
        <div key={iconName}>
          <Icon {...args} icon={iconName} />
          <p style={{ margin: '4px' }}>{iconName}</p>
        </div>
      ))}
    </div>
  ),
}
```
ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ ì•„ì´ì½˜ë“¤ì„ í•œ ë²ˆì— í™•ì¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¤‘ë³µë°©ì§€ì™€ í•¨ê»˜ ì‹ ê·œ ë””ìì¸ ì‹œì— ìœ ìš©í–ˆê¸° ë•Œë¬¸ì— ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë–„ í•­ìƒ ë§Œë“¤ì–´ë‘¡ë‹ˆë‹¤.

## Apollo Client(GraphQL)ì™€ Storybook í†µí•©
GraphQLë°ì´í„°ê°€ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ê°€ ì¡´ì¬í–ˆê¸° ë•Œë¬¸ì— Storybookì—ì„œë„ Apollo Clientë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ì„ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.
ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì•„ë‹Œ ì‚¬ì „ì— ì„¤ì •í•œ Mockë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê°œë…ì…ë‹ˆë‹¤.
Apollo Clientì˜ useQueryë‚˜ useMutation í›…ìœ¼ë¡œ ë°œìƒí•˜ëŠ” GraphQL ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ë¯¸ë¦¬ ì •ì˜í•œ mock ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

### ê°œë³„ ìŠ¤í† ë¦¬
```ts
import { Meta, StoryObj } from '@storybook/react'
import { useState } from 'react'
import { FormProvider, useForm } from 'react-hook-form'
import { TestDialog } from './scope-condition-dialog'
import { MockedProvider } from '@apollo/client/testing'
import { TestMockDocument } from '@/graphql-types'

// í•„ìš”í•œ mockë¥¼ ì‘ì„±
const MockData = {
  request: {
    query: TestMockDocument,
    variables: {},
  },
  result: {
    data: {
      msMockData: [
        {
          __typename: 'MsMockType',
          id: '1',
          name: 'coffeee',
        },
        { __typename: 'MsMockType', id: '2', name: 'cake' },
        {
          __typename: 'MsMockType',
          id: '3',
          name: 'snack',
        },
        {
          __typename: 'MsMockType',
          id: '4',
          name: 'macaron',
        },
        { __typename: 'MsMockType', id: '5', name: 'chocolate' },
        { __typename: 'MsMockType', id: '6', name: 'ichigo' },
      ],
    },
  },
}

const meta: Meta<typeof TestDialog> = {
  title: 'Event/TestDialog',
  component: TestDialog,
  parameters: {
    layout: 'centered',
  },
  decorators: [
    (Story) => (
      // decoratorsì— MockedProviderì™€ ì‘ì„±í•œ mockë°ì´í„°ë¥¼ ì„¤ì •
      <MockedProvider mocks={[MockData]} addTypename={false}>
        <Story />
      </MockedProvider>
    ),
  ],
  argTypes: {
    dialogState: { control: 'boolean' },
  },
}

export default meta
type Story = StoryObj<typeof TestDialog>

export const Default: Story = {
  render: (args) => {
    const form = useForm<any>({
      mode: 'all',
    })
    const { control } = form

    const [isActive, setIsActive] = useState(true)

    return (
      <FormProvider {...form}>
        <TestDialog
          control={control}
          dialogState={[isActive, setIsActive]}
        />
      </FormProvider>
    )
  },
}
```

ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. mock ë°ì´í„° ì •ì˜
`const MockData`ì™€ ê°™ì´ mock ë°ì´í„°ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
request.queryì—ëŠ” ëª¨í‚¹í•  GraphQL documentë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.
request.variablesëŠ” í•´ë‹¹ ì¿¼ë¦¬ì— ë„˜ê²¨ì§ˆ ë³€ìˆ˜ì…ë‹ˆë‹¤.
result.dataì— ì›í•˜ëŠ” mock ë°ì´í„°ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

2. MockedProviderë¡œ ê°ì‹¸ê¸°
```ts
  <MockedProvider mocks={[MockData]} addTypename={false}>
    <Story />
  </MockedProvider>
```
mocks propì— ìœ„ì—ì„œ ì •ì˜í•œ mock ë°°ì—´ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
addTypename={false}ëŠ” mock ë°ì´í„°ì— ì§ì ‘ typenameì„ ë„£ì—ˆê¸° ë•Œë¬¸ì— Apolloê°€ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤.

3. ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì¿¼ë¦¬ í˜¸ì¶œ
ìŠ¤í† ë¦¬ê°€ ì‹œì‘ë˜ì–´ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì¿¼ë¦¬ê°€ í˜¸ì¶œë˜ë©´ ë„¤íŠ¸ì›Œí¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ëŒ€ì‹ , MockedProviderê°€ request.queryì™€ request.variablesê°€ ì¼ì¹˜í•˜ëŠ” mockì„ ì°¾ì•„ result.dataë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.

### ê¸€ë¡œë²Œ ìŠ¤í† ë¦¬
í•˜ë‚˜ì˜ ìŠ¤í† ë¦¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ê¸€ë¡œë²Œì—ì„œ í•„ìš”í•œ mockë°ì´í„°ë¼ë©´ previewì— ì„¤ì •í•©ë‹ˆë‹¤.
ë‘ ê°€ì§€ ë°©ì‹ ì¤‘ì— í¸í•œ ê²ƒì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

1. decoratorsë°©ì‹
```ts
// storybook/preview.ts
import type { Preview } from '@storybook/react';
import '../styles/globals.scss';
import { MockedProvider } from '@apollo/client/testing';

// ê¸€ë¡œë²Œë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ mockë°ì´í„°
import { MockData } from '../src/mocks';

const preview: Preview = {
  decorators: [
    (Story) => (
      <MockedProvider mocks={[MockData]} addTypename={false}>
        <Story />
      </MockedProvider>
    ),
  ],
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: { â€¦ },
  },
}

export default preview;
```

2. storybook-addon-apollo-client ì‚¬ìš©
mainíŒŒì¼ì— addon ì„¤ì •
```ts
// storybook/main.ts
addons: [
    'storybook-addon-apollo-client',
    ...
  ],
```
```ts
import type { Preview } from '@storybook/react';
import '../styles/globals.scss';

import { MockedProvider } from '@apollo/client/testing';
import { withApolloClient } from 'storybook-addon-apollo-client';

// ê¸€ë¡œë²Œë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ mockë°ì´í„°
import { MockData } from '../src/mocks';

export const decorators = [
  // ëª¨ë“  ìŠ¤í† ë¦¬ë¥¼ ì´ ë°ì½”ë ˆì´í„°ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
  withApolloClient({
    MockedProvider,
    // storybook-addon-apollo-clientì€ ì—¬ê¸° ì •ì˜í•œ mocks ë°°ì—´ì„
    // ê° ìŠ¤í† ë¦¬ì— apolloClient.parameters.mocksë¡œ ì£¼ì…í•´ì¤ë‹ˆë‹¤
    mocks: [
      MockData,
      // í•„ìš”í•˜ë‹¤ë©´ ì¶”ê°€ mockâ€¦
    ],
    addTypename: false, // mock ë°ì´í„°ì— __typenameì„ ì§ì ‘ ë„£ì—ˆë‹¤ë©´ false
  }),
]

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    apolloClient: {
      // https://storybook.js.org/addons/storybook-addon-apollo-client
      MockedProvider,
    },
  },
}
```

## ìŠ¤í…Œì´ì§• ì„œë²„ ìë™ Storybook ê¸°ë™ ì„¤ì • (Docker)
ë¡œì»¬ì—ì„œì˜ ìŠ¤í† ë¦¬ ì‘ì„± ì‘ì—…ì´ ëë‚˜ë©´ ë‹¤ë¥¸ ì‘ì—…ì, ë””ìì´ë„ˆë“¤ë„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ìŠ¤í…Œì´ì§• ì„œë²„ì— ì ìš©í•©ë‹ˆë‹¤.
```dockerfile
# syntax=docker/dockerfile:1

# npm install
...

# build
FROM node:20.17.0-alpine3.20 AS builder

ARG stage=""

RUN npm run build

// storybook ë¹Œë“œë¥¼ ì¶”ê°€
RUN npm run build-storybook

# runner
FROM node:20.17.0-alpine3.20 AS runner

...

CMD ["node", "server.js"]
```

### nginx ì—ëŸ¬ í•´ê²°í•˜ê¸°
Docker ì„¤ì •ì„ ëë‚´ê³  ìŠ¤í…Œì´ì§• ì„œë²„ì˜ ìŠ¤í† ë¦¬ë¶ì— ì ‘ì†í•´ë³´ë‹ˆ ìŠ¤í† ë¦¬ëŠ” ì—´ë¦¬ëŠ”ë° ì»´í¬ë„ŒíŠ¸ê°€ ë¬´í•œ ë¡œë”© ìƒíƒœì˜€ìŠµë‹ˆë‹¤.
ê°œë°œìíˆ´ì„ ì—´ì–´ ì½˜ì†”ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ë‹ˆ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ê²€ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.
`Refused to display 'https://stg.******.jp/' in a frame because it set 'X-Frame-Options' to 'deny'.`
nginxì˜ `add_header X-Frame-Options DENY;` ì„¤ì •ìœ¼ë¡œ ì¸í•´ iframeì´ ê±°ë¶€ ëœ ê²ƒì´ ì›ì¸ì´ì—ˆìŠµë‹ˆë‹¤.
ìŠ¤í† ë¦¬ë¶ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ iframe ì•ˆì—ì„œ ë Œë”ë§í•˜ê¸° ë•Œë¬¸ì— iframeì„ í—ˆìš©í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```conf
location /storybook/ {
    proxy_pass http://127.0.0.1:3000;

    proxy_set_header X-Forwarded-For $http_x_forwarded_for;
    proxy_hide_header X-Powered-By;
    // iframe ì°¨ë‹¨ì„ ë§‰ê¸°ìœ„í•´ X-Frame-Optionsì— ë¹ˆ ê°’ì„ ì„¤ì •
    add_header X-Frame-Options "";
}
```
`add_header X-Frame-Options ""`ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

### ìŠ¤í…Œì´ì§•ì—ë§Œ ê³µê°œí•˜ê¸°
iframeë¬¸ì œê°€ í•´ê²°ëê¸° ë•Œë¬¸ì— ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„  ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.
ìŠ¤í† ë¦¬ë¶ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê°œë°œ í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ìš´ì˜ì„œë²„ì—ì„œëŠ” ê¸°ë™í•˜ì§€ ì•Šë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.
ë‹¤ì‹œ dockerfileë¡œ ëŒì•„ì™€ì„œ ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œë§Œ ìŠ¤í† ë¦¬ë¶ì´ ë¹Œë“œ ë˜ë„ë¡ ë¶„ê¸° ì²˜ë¦¬ë¥¼ í•´ì¤ë‹ˆë‹¤.
```dockerfile
# npm install
...

# build
FROM node:20.17.0-alpine3.20 AS builder

ARG stage=""

RUN npm run build

â†“ ë³€ê²½
# build for staging
FROM builder AS staging-builder
RUN npm run build-storybook

# runner for staging
FROM runner AS staging-runner
COPY --from=staging-builder /usr/src/app/storybook-static ./public/storybook-static
```
ì´ë ‡ê²Œ í•˜ë©´ ìš´ì˜ì„œë²„ëŠ” ìŠ¤í† ë¦¬ë¶ì„ ë¹Œë“œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í˜ì´ì§€ê°€ ë©ë‹ˆë‹¤.

### rewrite ì„¤ì •
ìŠ¤í† ë¦¬ë¶ì´ ì •ì  íŒŒì¼ë¡œ ë¹Œë“œ ë˜ê¸° ë•Œë¬¸ì— í™•ì¸ì„ ìœ„í•´ì„œ `/storybook-static/index.html`ì™€ ê°™ì´ urlì„ ì…ë ¥í•´ì•¼í•©ë‹ˆë‹¤.
ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì— ê°„ë‹¨íˆ `/storybook`ìœ¼ë¡œ ì ‘ì†í•˜ë„ë¡ next.configì— rewriteë¥¼ ì„¤ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

```js
async rewrites() {
    return [
      {
        source: '/storybook',
        destination: '/storybook-static/index.html',
      },
      {
        source: '/storybook/:path*',
        destination: '/storybook-static/:path*',
      },
    ];
  },
```
---
## ë§ˆì¹˜ë©°
ì´ë ‡ê²Œ Storybookì„ ìµœì‹  ë²„ì „ìœ¼ë¡œ ë‹¤ì‹œ ì„¤ì •í•˜ê³  Docker í™˜ê²½ê³¼ Apollo Clientë¥¼ í†µí•©í•˜ì—¬ ê°œë°œ í™˜ê²½ì„ ë³µêµ¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ì˜¤ë«ë™ì•ˆ ë°©ì¹˜ëœ ê°œë°œ í™˜ê²½ì„ ìµœì‹ í™”í•˜ëŠ” ê³¼ì •ì—ì„œ ë§ì€ ì‹œí–‰ì°©ì˜¤ì™€ í•™ìŠµì´ ìˆì—ˆê³  ì´ë¥¼ í†µí•´ ë„êµ¬ì˜ ì¤‘ìš”ì„±ê³¼ íš¨ê³¼ì ì¸ í˜‘ì—… í™˜ê²½ êµ¬ì¶•ì˜ í•„ìš”ì„±ì„ ë‹¤ì‹œ í•œë²ˆ ì•Œê²Œë˜ì—ˆìŠµë‹ˆë‹¤.
ì•ìœ¼ë¡œë„ ê°œë°œ ìƒì‚°ì„±ì„ ë†’ì¼ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë„êµ¬ì™€ í™˜ê²½ ì„¤ì •ì„ ê¾¸ì¤€íˆ íƒìƒ‰í•˜ê³  ìœ ìš©í•œ ë‚´ìš©ì„ ì§€ì†ì ìœ¼ë¡œ ê¸°ë¡í•˜ì—¬ ê³µìœ í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

