---
title: 'Storybookã‚’å¾©æ´»ã•ã›ã‚‹(+ with Apollo Client)'
desc: storybook & apollo-client
date: 2025-04-20
thumbnail: /posts/workLog/storybook-apollo/sbicon.avif
---

<h1>storybookã‚’å¾©æ´»ã•ã›ã‚‹</h1>

æ–°ã—ãå…¥ã£ãŸç¾å ´ã§ä»¥å‰ä½¿ã£ã¦ã„ãŸStorybookãŒã‚ã‚‹ç¬é–“ã‹ã‚‰æ­£å¸¸ã«ä½œå‹•ã—ãªã„çŠ¶æ…‹ã«ãªã£ãŸã®ã§å¾©æ´»ã•ã›ã¦ãã ã•ã„ã¨ã„ã†ä¾é ¼ãŒå…¥ã‚Šã¾ã—ãŸã€‚
ã“ã®æ©Ÿä¼šã«æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸€ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€Dockerç’°å¢ƒã¨Apollo Clientï¼ˆGraphQLï¼‰ã‚’æ´»ç”¨ã—ã¦å†æ§‹ç¯‰ã—ãŸæ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---
## Storybookã¨ã¯?
Storybookã¯UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã—ã¦é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¦–è¦šçš„ã«è¡¨ç¤ºã™ã‚‹ã“ã¨ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã¨ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã®å”æ¥­ã¨åŠ¹ç‡æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®è©²å½“ãƒšãƒ¼ã‚¸ã¸ã‚¢ã‚¯ã‚»ã‚¹ã›ãšã¨ã‚‚ã€å˜ä½“ã§å‹•ä½œã‚’ãƒã‚§ãƒƒã‚¯ã§ãã‚‹ã®ãŒæœ€å¤§ã®ãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚
ãã—ã¦ã€ç¾åœ¨ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¸€ç›®ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã€ç‹¬ç«‹ã—ãŸçŠ¶æ…‹ã§ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
å€‹äººçš„ã«ã¯ä¸€èˆ¬çš„ãªçŠ¶æ…‹ã§ã¯ç¢ºèªã—ã«ãã„ãƒ¢ãƒ¼ãƒ€ãƒ«ã€ã‚¢ã‚¤ã‚³ãƒ³ã€çŠ¶æ…‹å¤‰åŒ–ã«ã‚ˆã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯ã®éš›ã«æœ‰ç”¨ã«ä½¿ã„ã¾ã—ãŸã€‚
è©³ç´°ã¯å…¬å¼ã‚µã‚¤ãƒˆã‚’å‚ç…§ ğŸ‘‰ [storybook](https://storybook.js.org/)

## Apollo Clientã¨ã¯?
Apollo Clientã¯GraphQLã‚¯ã‚¨ãƒªã‚’é€šã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨é€£æºã™ã‚‹JavaScriptã®çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
åŠ¹ç‡çš„ã‹ã¤æŸ”è»Ÿãªãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
è©³ç´°ã¯å…¬å¼ã‚µã‚¤ãƒˆã‚’å‚ç…§ ğŸ‘‰ [apollographql](https://www.apollographql.com/docs/react)

## æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³Storybookã®å‰Šé™¤ã¨æ–°è¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ—¢å­˜ã®æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³StorybookãŒæœ€æ–°ç’°å¢ƒã¨ã®äº’æ›æ€§ã«å•é¡ŒãŒã‚ã£ãŸãŸã‚ã€å®Œå…¨ã«å‰Šé™¤ã—ã¦æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Storybookã‚’æ–°ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
æ–°ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸStorybookã¨ã‚¢ãƒ‰ã‚ªãƒ³ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚
```json
"@storybook/addon-essentials": "7.6.20",
"@storybook/addon-interactions": "7.6.20",
"@storybook/addon-links": "7.6.20",
"@storybook/addon-onboarding": "1.0.11",
"@storybook/blocks": "7.6.20",
"@storybook/nextjs": "7.6.20",
"@storybook/react": "7.6.20",
"@storybook/test": "7.6.20",
"storybook": "7.6.20",
"storybook-addon-apollo-client": "5.0.0",
```

## Storybookã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã¨å‹•ä½œç¢ºèª
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€Storybookã‚’èµ·å‹•ã—ã¦æ­£å¸¸ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚
```sh
npm run storybook
```
åˆæœŸãƒãƒ¼ãƒˆç•ªå·ã¯6006ãªã®ã§`http://localhost:6006`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸã€‚

## Dockerç’°å¢ƒã§ã®Storybookãƒãƒ¼ãƒˆé–‹æ”¾
ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§ã®Storybookèµ·å‹•ã¯å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ã“ã‚Œã ã‘ã§ã¯ãƒšãƒ¼ã‚¸ãŒé–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚
åŸå› ã¯Dockerç’°å¢ƒã§èµ·å‹•ã—ãŸãŸã‚ã§ã™ã€‚
æ–°ã—ã„ãƒãƒ¼ãƒˆã‚’ä½¿ã†ãŸã‚ã«ã¯Dockerã§è©²å½“ãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒãƒ¼ãƒˆã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã—ãŸã€‚
```yaml
# docker-compose.yml
mintora:
    container_name: test-web
    build:
      context: .
      dockerfile: docker/web/local.Dockerfile
    ports:
      - "6006:6006" // storybook ãƒãƒ¼ãƒˆé–‹æ”¾
    volumes:
      - ./web:/usr/src/app:cached
      - node_modules:/usr/src/app/node_modules
    command: npm run dev
```

ãƒãƒ¼ãƒˆã‚’é–‹æ”¾å¾Œã«å†èµ·å‹•ã™ã‚‹ã¨ã€StorybookãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚
![åˆæœŸç’°å¢ƒ](/posts/workLog/storybook-apollo/storybook_init.png)

## Storybookè¨­å®š
æ–°è¦ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸStorybookã‚’ç¾åœ¨ã®ç’°å¢ƒã«åˆã‚ã›ã‚‹ãŸã‚ã€configã¨previewãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã—ã¾ã—ãŸã€‚

main.tsã«ã¯storiesãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ãƒ‘ãƒ¼ã‚¹ã¨ä½¿ç”¨ã™ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¨­å®šã—ã¾ã—ãŸã€‚
```ts
// storybook/main.ts
import type { StorybookConfig } from '@storybook/nextjs'

const path = require('path')

const config: StorybookConfig = {
  stories: [
    '../**/**/*.stories.@(js|jsx|mjs|ts|tsx)',
  ],
  addons: [
    '@storybook/addon-links',
    '@storybook/addon-essentials',
    '@storybook/addon-onboarding',
    '@storybook/addon-interactions',
    'storybook-addon-apollo-client',
  ],
  framework: {
    name: '@storybook/nextjs',
    options: {},
  },
  staticDirs: ['../public'],
  webpackFinal: async (config) => {
    config.resolve = config.resolve || {}
    config.module = config.module || {}
    config.module.rules = config.module.rules || []

    config.resolve.alias = {
      ...config.resolve.alias,
      '@': path.resolve(__dirname, '../'),
      '@styles': path.resolve(__dirname, '../styles'),
      '@components': path.resolve(__dirname, '../components'),
    }
    config.devtool = false
    return config
  },
}
export default config
```

preview.tsã«ã¯apollo clientä½¿ç”¨ã®ãŸã‚ã€MockedProviderã‚’è¨­å®šã—ã¦ãŠãã¾ã—ãŸã€‚
```ts
// storybook/preview.ts
import type { Preview } from '@storybook/react'
import '../styles/globals.scss'
import { MockedProvider } from '@apollo/client/testing'

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    apolloClient: {
      // apollo/clientã¨Storybookã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦Addonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§æ³¨æ„
      // https://storybook.js.org/addons/storybook-addon-apollo-client
      MockedProvider,
    },
  },
}

export default preview
```

## storiesä½œæˆ
ã“ã‚Œã§åˆæœŸç’°å¢ƒè¨­å®šãŒå®Œäº†ã•ã‚Œã¾ã—ãŸã®ã§ã€storiesãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

storiesãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¾ã™ã€‚
```ts
// Button/index.stories.tsx
import {
  PrimaryButton,
  ...
} from './index'
import type { Meta, StoryObj } from '@storybook/react'

const meta: Meta = {
  title: 'Components/Buttons',
  parameters: {
    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé…ç½®: centered, fullscreen, padded
    layout: 'centered',
  },
  // Docè‡ªå‹•ä½œæˆ
  tags: ['autodocs'],
  // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¼•æ•°æŒ‡å®šè¨­å®š
  argTypes: {
    icon: {
      control: 'text',
      description: 'iconå',
    },
    disabled: {
      control: 'boolean',
      description: 'Disabled',
    },
  },
}
export default meta

export const Primary: StoryObj<typeof PrimaryButton> = {
  render: (args) => <PrimaryButton {...args} />,
  args: {
    type: 'button',
    icon: 'offer',
    disabled: false,
    isLoading: false,
    onClick: () => {
      alert('click')
    },
  },
}
...
```

å®Ÿéš›ã«ä½¿ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»¥å¤–ã«ã€å˜ç´”ç¢ºèªã®ãŸã‚ã«ã‚‚storiesã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»¥ä¸‹ã¯ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒªã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ä½œæˆã—ãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ã™ã€‚
```ts
// Icon/index.stories.tsx
import { Icon } from './index'
import type { Meta, StoryObj } from '@storybook/react'

const meta = {
  title: 'Components/Icon',
  component: Icon,
  parameters: {
    // centered, fullscreen, padded
    layout: 'padded',
  },
  argTypes: {
    icon: {
      control: 'text',
      description: 'iconå',
    },
    size: {
      control: 'number',
      description: 'ã‚µã‚¤ã‚º(rem)',
    },
  },
  tags: ['autodocs'],
} satisfies Meta<typeof Icon>

export default meta
type Story = StoryObj<typeof meta>

const glyphNames = [
  'camera',
  'operating',
  'company',
  'document',
  'instagram',
  'logout',
  'question',
  ... çœç•¥
  'operator',
  'searchCheck',
]

export const Default: Story = {
  args: {
    icon: '',
    size: 24,
  },
  render: (args) => (
    <div style={{ display: 'flex', flexDirection: 'column' }}>
      {glyphNames.map((iconName) => (
        <div key={iconName}>
          <Icon {...args} icon={iconName} />
          <p style={{ margin: '4px' }}>{iconName}</p>
        </div>
      ))}
    </div>
  ),
}
```
ã“ã®ã‚ˆã†ã«ä½œæˆã™ã‚Œã°ã€ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸€ç›®ã«ç¢ºèªã§ãã‚‹ã®ã§ã€é‡è¤‡é˜²æ­¢ã¨å…±ã«æ–°è¦ãƒ‡ã‚¶ã‚¤ãƒ³ã®éš›ã«è‰¯ã„ã®ã§ã€æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹æ™‚ã«å¸¸ã«ä½œã£ã¦ãŠãã¾ã™ã€‚

## Apollo Client(GraphQL)ã¨Storybookã®çµ±åˆ
GraphQLãƒ‡ãƒ¼ã‚¿ã‚’å¿…è¦ã¨ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå­˜åœ¨ã—ãŸãŸã‚ã€Storybookã§ã‚‚Apollo Clientã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸã€‚
å®Ÿéš›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ãªãã€äº‹å‰ã«å®šç¾©ã—ãŸMockãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ä»•çµ„ã¿ã§ã™ã€‚
Apollo Clientã®useQueryã‚„useMutationãƒ•ãƒƒã‚¯ã§ç™ºç”Ÿã™ã‚‹GraphQLã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¨ªå–ã‚Šã—ã¦å®šç¾©ã—ãŸmockãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™ã€‚

### å€‹åˆ¥ã‚¹ãƒˆãƒ¼ãƒªãƒ¼
```ts
import { Meta, StoryObj } from '@storybook/react'
import { useState } from 'react'
import { FormProvider, useForm } from 'react-hook-form'
import { TestDialog } from './scope-condition-dialog'
import { MockedProvider } from '@apollo/client/testing'
import { TestMockDocument } from '@/graphql-types'

// å¿…è¦ãªmockã‚’ä½œæˆ
const MockData = {
  request: {
    query: TestMockDocument,
    variables: {},
  },
  result: {
    data: {
      msMockData: [
        {
          __typename: 'MsMockType',
          id: '1',
          name: 'coffeee',
        },
        { __typename: 'MsMockType', id: '2', name: 'cake' },
        {
          __typename: 'MsMockType',
          id: '3',
          name: 'snack',
        },
        {
          __typename: 'MsMockType',
          id: '4',
          name: 'macaron',
        },
        { __typename: 'MsMockType', id: '5', name: 'chocolate' },
        { __typename: 'MsMockType', id: '6', name: 'ichigo' },
      ],
    },
  },
}

const meta: Meta<typeof TestDialog> = {
  title: 'Event/TestDialog',
  component: TestDialog,
  parameters: {
    layout: 'centered',
  },
  decorators: [
    (Story) => (
      // decoratorsã«MockedProviderã¨ä½œæˆã—ãŸmockãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
      <MockedProvider mocks={[MockData]} addTypename={false}>
        <Story />
      </MockedProvider>
    ),
  ],
  argTypes: {
    dialogState: { control: 'boolean' },
  },
}

export default meta
type Story = StoryObj<typeof TestDialog>

export const Default: Story = {
  render: (args) => {
    const form = useForm<any>({
      mode: 'all',
    })
    const { control } = form

    const [isActive, setIsActive] = useState(true)

    return (
      <FormProvider {...form}>
        <TestDialog
          control={control}
          dialogState={[isActive, setIsActive]}
        />
      </FormProvider>
    )
  },
}
```

ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. mockãƒ‡ãƒ¼ã‚¿å®šç¾©
`const MockData`ã®ã‚ˆã†ã«mockãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚
request.queryã«ã¯ãƒ¢ãƒƒã‚¯ã‚­ãƒ³ã‚°ã™ã‚‹GraphQL documentã‚’å…¥ã‚Œã¦ãŠãã¾ã™ã€‚
request.variablesã¯è©²å½“ã‚¯ã‚¨ãƒªã«æ¸¡ã•ã‚Œã‚‹å¤‰æ•°ã§ã™ã€‚
result.dataã«ã»ã—ã„mockãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚

2. MockedProviderã§ãƒ©ãƒƒãƒ—
```ts
  <MockedProvider mocks={[MockData]} addTypename={false}>
    <Story />
  </MockedProvider>
```
mocks propã«å®šç¾©ã—ãŸmocké…åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚
addTypename={false}ã¯mockãƒ‡ãƒ¼ã‚¿ã«ç›´æ¥ã€typenameã‚’å…¥ã‚ŒãŸãŸã‚ã€ApolloãŒè‡ªå‹•ã«è¿½åŠ ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚

3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†…éƒ¨ã§ã‚¯ã‚¨ãƒªå‘¼ã³å‡ºã—
ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒå§‹ã¾ã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã§ã‚¯ã‚¨ãƒªãƒ¼ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å‘¼ã³å‡ºã™ä»£ã‚ã‚Šã«ã€MockedProviderãŒrequest.queryã¨request.variablesãŒä¸€è‡´ã™ã‚‹mockã‚’æ¢ã—ã¦result.dataã‚’ãƒªã‚¿ãƒ¼ãƒ³ã—ã¾ã™ã€‚

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼
ä¸€ã¤ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ä½¿ç”¨ã™ã‚‹ã®ã§ã¯ãªãã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§å¿…è¦ãªmockãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚Œã°previewã«è¨­å®šã—ã¾ã™ã€‚
äºŒã¤ã®æ–¹æ³•ã®ä¸­ã§æ¥½ãªã‚‚ã®ã‚’ä½¿ãˆã°ã„ã„ã§ã™ã€‚

1. decoratorsæ–¹å¼
```ts
// storybook/preview.ts
import type { Preview } from '@storybook/react';
import '../styles/globals.scss';
import { MockedProvider } from '@apollo/client/testing';

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ä½¿ã„ãŸã„mockãƒ‡ãƒ¼ã‚¿
import { MockData } from '../src/mocks';

const preview: Preview = {
  decorators: [
    (Story) => (
      <MockedProvider mocks={[MockData]} addTypename={false}>
        <Story />
      </MockedProvider>
    ),
  ],
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: { â€¦ },
  },
}

export default preview;
```

2. storybook-addon-apollo-clientä½¿ç”¨
mainãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ãƒ‰ã‚ªãƒ³è¨­å®š
```ts
// storybook/main.ts
addons: [
    'storybook-addon-apollo-client',
    ...
  ],
```
```ts
import type { Preview } from '@storybook/react';
import '../styles/globals.scss';

import { MockedProvider } from '@apollo/client/testing';
import { withApolloClient } from 'storybook-addon-apollo-client';

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ä½¿ã„ãŸã„mockãƒ‡ãƒ¼ã‚¿
import { MockData } from '../src/mocks';

export const decorators = [
  // å…¨ã¦ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ã“ã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã¾ã™ã€‚
  withApolloClient({
    MockedProvider,
    // storybook-addon-apollo-clientã¯ã“ã“ã«å®šç¾©ã—ãŸmocksé…åˆ—ã‚’
    // å„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã«apolloClient.parameters.mocksã«å…¥ã‚Œã¦ãã‚Œã¾ã™ã€‚
    mocks: [
      MockData,
      // å¿…è¦ãªã‚‰è¿½åŠ  mockâ€¦
    ],
    addTypename: false, // mockãƒ‡ãƒ¼ã‚¿ã«__typenameã‚’ç›´æ¥å…¥ã‚ŒãŸã‚‰false
  }),
]

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    apolloClient: {
      // https://storybook.js.org/addons/storybook-addon-apollo-client
      MockedProvider,
    },
  },
}
```

## ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã§ã®è‡ªå‹•Storybookèµ·å‹•è¨­å®š(Docker)
ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä½œæˆå¾Œä½œæ¥­ãŒçµ‚ã‚ã£ãŸã‚‰ã€ä»–ã®é–‹ç™ºè€…ã‚„ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã‚‚ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
```dockerfile
# syntax=docker/dockerfile:1

# npm install
...

# build
FROM node:20.17.0-alpine3.20 AS builder

ARG stage=""

RUN npm run build

// storybookãƒ“ãƒ«ãƒ‰ã‚’è¿½åŠ 
RUN npm run build-storybook

# runner
FROM node:20.17.0-alpine3.20 AS runner

...

CMD ["node", "server.js"]
```

### nginxã‚¨ãƒ©ãƒ¼å¯¾å¿œ
Dockerè¨­å®šã‚’çµ‚ãˆã¦ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ–ãƒƒã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ãŸã‚‰ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¯é–‹ãã¾ã™ãŒã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç„¡é™ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã§ã—ãŸã€‚
ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚
`Refused to display 'https://stg.******.jp/' in a frame because it set 'X-Frame-Options' to 'deny'.`
nginxã®`add_header X-Frame-Options DENY;` è¨­å®šã«ã‚ˆã‚ŠiframeãŒæ‹’å¦ã•ã‚ŒãŸã®ãŒåŸå› ã§ã—ãŸã€‚
ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ–ãƒƒã‚¯ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’iframeä¸­ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã€iframeã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```conf
location /storybook/ {
    proxy_pass http://127.0.0.1:3000;

    proxy_set_header X-Forwarded-For $http_x_forwarded_for;
    proxy_hide_header X-Powered-By;
    // iframeãƒ–ãƒ­ãƒƒã‚¯ã‚’é˜²ããŸã‚X-Frame-Optionsã‚’ç©ºã«è¨­å®š
    add_header X-Frame-Options "";
}
```
`add_header X-Frame-Options ""`ã‚’è¨­å®šã—ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«ã®ã¿å…¬é–‹ã™ã‚‹
iframeå•é¡ŒãŒè§£æ±ºã•ã‚ŒãŸãŸã‚ã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚
ã—ã‹ã—ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ–ãƒƒã‚¯ã¯åŸºæœ¬çš„ã«é–‹ç™ºç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã‚‹ãŸã‚ã€æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã§ã¯èµ·å‹•ã—ãªã„ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
å†ã³dockerfileã«æˆ»ã£ã¦ã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã®ã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ–ãƒƒã‚¯ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ã‚ˆã†ã«åˆ†å²å‡¦ç†ã‚’ã—ã¾ã™ã€‚
```dockerfile
# npm install
...

# build
FROM node:20.17.0-alpine3.20 AS builder

ARG stage=""

RUN npm run build

â†“ å¤‰æ›´
# build for staging
FROM builder AS staging-builder
RUN npm run build-storybook

# runner for staging
FROM runner AS staging-runner
COPY --from=staging-builder /usr/src/app/storybook-static ./public/storybook-static
```
ã“ã®ã‚ˆã†ã«ã™ã‚Œã°ã€æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã¯ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ–ãƒƒã‚¯ã‚’ãƒ“ãƒ«ãƒ‰ã—ãªã„ã®ã§ã€å­˜åœ¨ã—ãŸã„ãƒšãƒ¼ã‚¸ã«ãªã‚Šã¾ã™ã€‚

### rewriteè¨­å®š
ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ–ãƒƒã‚¯ã¯é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ãŸã‚ã€ç¢ºèªã®ãŸã‚ã«`/storybook-static/index.html`ã®ã‚ˆã†ã«urlã‚’å…¥åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯é¢å€’ãªã®ã§ã€ç°¡å˜ã«`/storybook`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã€next.configã«rewriteã‚’è¨­å®šã—ã¾ã—ãŸã€‚

```js
async rewrites() {
    return [
      {
        source: '/storybook',
        destination: '/storybook-static/index.html',
      },
      {
        source: '/storybook/:path*',
        destination: '/storybook-static/:path*',
      },
    ];
  },
```
---
## ãŠã‚ã‚Šã«
ã“ã®ã‚ˆã†ã«Storybookã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å†è¨­å®šã—ã€Dockerç’°å¢ƒã¨Apollo Clientã‚’çµ±åˆã—ã¦é–‹ç™ºç’°å¢ƒã‚’å¾©æ—§ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
é•·ã„é–“æ”¾ç½®ã•ã‚ŒãŸé–‹ç™ºç’°å¢ƒã‚’æœ€æ–°åŒ–ã™ã‚‹éç¨‹ã§ã€å¤šãã®è©¦è¡ŒéŒ¯èª¤ã¨å­¦ç¿’ãŒã‚ã‚Šã€ã“ã‚Œã‚’é€šã˜ã¦ãƒ„ãƒ¼ãƒ«ã®é‡è¦æ€§ã¨åŠ¹æœçš„ãªå”æ¥­ç’°å¢ƒæ§‹ç¯‰ã®å¿…è¦æ€§ã‚’æ”¹ã‚ã¦çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã“ã‚Œã‹ã‚‰ã‚‚é–‹ç™ºç”Ÿç”£æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹æ§˜ã€…ãªãƒ„ãƒ¼ãƒ«ã¨ç’°å¢ƒè¨­å®šã‚’ç€å®Ÿã«æ¢ç´¢ã—ã€æœ‰ç”¨ãªå†…å®¹ã‚’æŒç¶šçš„ã«è¨˜éŒ²ã—ã¦å…±æœ‰ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
