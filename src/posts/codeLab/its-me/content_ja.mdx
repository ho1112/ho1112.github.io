---
title: 'AI基盤インタラクティブポートフォリオチャットボット (its-me)'
desc: 'RAG基盤の対話型ポートフォリオチャットボット開発過程と技術的実装方法を紹介します。'
date: 2025-09-07
thumbnail: /posts/codeLab/its-me/thumbnail.avif
---

# AI基盤インタラクティブポートフォリオチャットボット (its-me)

## 1. 概要

**なぜこのプロジェクトを作ったのか？**
このプロジェクトは「AI、直接作ってみよう！」という純粋な好奇心から始まりました。最初に思い浮かんだアイテムはチャットボットでしたが、単純にAPIを呼び出すことを超えて特定の知識に基づいて回答するRAG(Retrieval-Augmented Generation)技術に大きな魅力を感じました。

「それではどんなデータを学習させればいいだろう？」悩んだ末、私が最もよく知っていて簡単に提供できるデータ、まさに**私自身**に関する情報を活用してみることにしました。そうして私の経歴、スキル、プロジェクト経験を回答してくれるRAGチャットボット'It's Me'が誕生しました。

**目標：**
RAG(Retrieval Augmented Generation)技術を活用して対話型ポートフォリオチャットボットを開発し、外部サイトに埋め込み可能な独立型ウィジェットとして実装すること

---

## 2. 技術スタック

### Frontend
- **Next.js**
- **TypeScript**
- **Tailwind CSS**
- **shadcn/ui**
- **Vite**: ウィジェットビルド

### Backend/AI
- **LangChain.js**: RAGパイプライン構築
- **Google Gemini API**
- **Supabase**
- **pgvector**: HNSWインデックスを活用したベクトル類似度検索

### Deployment
- **Vercel**

---

## 3. 主要機能

### 知的な質問-回答システム
- ベクトル類似度検索による正確なポートフォリオ情報検索
- 自然言語質問に対する文脈的回答提供
- 回答失敗時自動fallback質問提案

### 多言語サポート
- 日本語/韓国語自動検出と回答
- URLパラメータ基盤言語、テーマ設定 (`?lang=ja&theme=dark`)
- 言語別カスタマイズ推奨質問システム

### テーマシステム
- ライト/ダークモードサポート
- リアルタイムテーマ切り替え
- 外部サイト埋め込み時完全CSS分離

### 外部サイト埋め込み
- 単一スクリプトタグで簡単埋め込み
Shadow DOMによる完全スタイル分離
ウィジェットをブログに埋め込むとブログの'prose'スタイルがウィジェットのCSSを汚染する問題が発生しました。
この問題を解決するため、過去商用サービスのグローバルナビゲーション開発時に使用したShadow DOM分離パターンを適用しました。当時も複数サービスにコンポーネントを埋め込みながらスタイル衝突を解決した経験のおかげで、同じ問題に直面したこのプロジェクトでも迅速かつ効果的に解決策を導入することができました。
<Callout type="info" title="関連プロジェクトポスト">
[Web Components(+Lit)](https://mintora.me/blog/ko/workLog/webComponents/)
[グローバルナビゲーションプロジェクト現場](https://mintora.me/profile/ko/#skyticket)
[プロフィールページ](/profile/ko/#its-me-chatbot-container/)
</Callout>

---

## 4. 機能実装
### 4.1 アーキテクチャ設計
<img src="/posts/codeLab/its-me/rag_archi.svg" alt="アーキテクチャ" width="700" />

#### DB
<img src="/posts/codeLab/its-me/table_ja.svg" alt="DB" width="500" />

### 4.2 RAGパイプライン構築
<img src="/posts/codeLab/its-me/data_pipeline_ja.svg" alt="pipe line" width="700" />

### 4.3 ベクトル検索

```typescript
// ベクトル検索と回答生成
const vectorStore = new SupabaseVectorStore(embeddings, {
  client: supabase,
  tableName: "itsme",
  queryName: "match_documents"
});

// 類似度0.5以上のみ採用
const searchResults = await vectorStore.similaritySearchWithScore(
  question,
  3,
  { score: 0.5 }
);
```

**核心実装ポイント：**
- `similaritySearchWithScore`で類似度スコア基盤フィルタリング
- 0.5以上のスコアのみ有効回答として判定
- タグ基盤メタデータ活用で正確度向上

### 4.4 Shadow DOMによるCSS分離

```typescript
// ウィジェット初期化時Shadow DOM生成
const shadowRoot = container.attachShadow({ mode: 'open' });
const styleElement = document.createElement('style');
styleElement.textContent = cssString; // Vite ?inlineで処理されたCSS
shadowRoot.appendChild(styleElement);
```

**解決した問題：**
- 外部サイトのCSSと衝突しない完全分離
- `?inline`接尾辞でTailwind CSSを文字列に変換
- テーマクラス適用時外部DOMに影響なし

### 4.5 推奨質問システム

```typescript
// コンテキスト基盤推奨質問生成
const generateSuggestions = (isFirstMessage: boolean, isSearchFailed: boolean, tags: string[]) => {
  if (isFirstMessage) return suggestions.initial;
  if (isSearchFailed) return suggestions.fallback;
  return suggestions.follow_up[tags[0]] || suggestions.fallback;
};
```

**実装特徴：**
- 初期対話、成功時、失敗時それぞれ異なる質問セット
- タグ基盤主題別推奨質問
- `NO_ANSWER_KEYWORD`による失敗検出

---

## 5. 成果

### 定量的指標
- **ベクトル検索閾値**: 0.5以上類似度スコアで設定
- **多言語サポート**: 日本語/韓国語サポート
- **CSS分離**: 外部サイト埋め込み時スタイル衝突解決 (Shadow DOM実装完了)
- **最小化状態**: 埋め込み時基本的にヘッダーのみ表示し、ユーザーが必要な時だけ拡張できる選択権を提供
<img src="/posts/codeLab/its-me/minimize.png" alt="最小化_最大化" width="700" />

### 定性的フィードバック
- **ユーザー体験**: 直感的な対話型インターフェースでポートフォリオ探索容易性向上
- **開発者体験**: 単一スクリプトタグで簡単埋め込み可能
- **保守性**: コンポーネント基盤構造で拡張性確保

---

## 6. インサイト

### 学んだ点
- **RAG技術の実務適用**: ベクトル検索とLLMの結合で正確な情報検索システム構築
- **Shadow DOMの活用**: 外部サイト埋め込み時完全分離実装

### 残念な点と改善方向
- **性能最適化**: ベクトル検索速度改善のためのインデックス調整必要(現在3072次元を再検討するかロジック改善)